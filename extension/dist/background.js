console.log("Magic Button background script loaded");chrome.runtime.onInstalled.addListener(e=>{console.log("Magic Button extension installed:",e.reason),e.reason==="install"&&chrome.storage.local.set({installDate:new Date().toISOString(),version:chrome.runtime.getManifest().version})});chrome.runtime.onMessage.addListener((e,o,t)=>{var r;switch(console.log("Background received message:",e),e.type){case"GET_SELECTED_TEXT":return a((r=o.tab)==null?void 0:r.id,t),!0;case"PROCESS_AI_REQUEST":return i(e.data,t),!0;default:console.warn("Unknown message type:",e.type)}});async function a(e,o){var t;try{if(!e){o({error:"No active tab found"});return}const s=((t=(await chrome.scripting.executeScript({target:{tabId:e},func:()=>{var n;return((n=window.getSelection())==null?void 0:n.toString())||""}}))[0])==null?void 0:t.result)||"";o({selectedText:s})}catch(r){console.error("Error getting selected text:",r),o({error:r instanceof Error?r.message:"Unknown error"})}}const c="https://magic-button-api-374140035541.europe-west1.run.app";async function i(e,o){try{console.log("Making API request to:",`${c}/api/genai/process`);const t=await fetch(`${c}/api/genai/process`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e.action,text:e.text,options:{context:e.context||""}})});if(!t.ok)throw new Error(`API Error: ${t.status} ${t.statusText}`);const r=await t.json();console.log("API Response:",r),o(r)}catch(t){console.error("Error processing AI request:",t),o({error:t instanceof Error?t.message:"Unknown error",action:e.action})}}
