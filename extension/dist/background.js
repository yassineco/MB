console.log("Magic Button background script loaded");chrome.runtime.onInstalled.addListener(e=>{console.log("Magic Button extension installed:",e.reason),e.reason==="install"&&chrome.storage.local.set({installDate:new Date().toISOString(),version:chrome.runtime.getManifest().version})});chrome.runtime.onMessage.addListener((e,r,t)=>{var o;switch(console.log("Background received message:",e),e.type){case"GET_SELECTED_TEXT":return i((o=r.tab)==null?void 0:o.id,t),!0;case"PROCESS_AI_REQUEST":return a(e.data,t),!0;default:console.warn("Unknown message type:",e.type)}});async function i(e,r){var t;try{if(!e){r({error:"No active tab found"});return}const c=((t=(await chrome.scripting.executeScript({target:{tabId:e},func:()=>{var n;return((n=window.getSelection())==null?void 0:n.toString())||""}}))[0])==null?void 0:t.result)||"";r({selectedText:c})}catch(o){console.error("Error getting selected text:",o),r({error:o instanceof Error?o.message:"Unknown error"})}}const s="https://magic-button-api-374140035541.europe-west1.run.app";async function a(e,r){try{console.log("Making API request to:",`${s}/api/genai/process`),console.log("Request data:",e);const t=await fetch(`${s}/api/genai/process`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e.action,text:e.text,options:e.options||{}})});if(!t.ok)throw new Error(`API Error: ${t.status} ${t.statusText}`);const o=await t.json();console.log("API Response:",o),r(o)}catch(t){console.error("Error processing AI request:",t),r({error:t instanceof Error?t.message:"Unknown error",action:e.action})}}
