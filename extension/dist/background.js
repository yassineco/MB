const c={BASE_URL:"https://magic-button-api-374140035541.europe-west1.run.app",ENDPOINTS:{HEALTH:"/health",PROCESS:"/api/genai/process",DEMO_STATUS:"/demo/status",RAG_DOCUMENTS:"/rag/documents",RAG_SEARCH:"/rag/search",RAG_GENERATE:"/rag/generate"},DEFAULT_HEADERS:{"Content-Type":"application/json"},TIMEOUT:3e4};console.log("Magic Button background script loaded");console.log("üöÄ API Configuration:",c.BASE_URL);chrome.runtime.onInstalled.addListener(o=>{console.log("Magic Button extension installed:",o.reason),o.reason==="install"&&chrome.storage.local.set({installDate:new Date().toISOString(),version:chrome.runtime.getManifest().version})});chrome.runtime.onMessage.addListener((o,n,e)=>{var t;switch(console.log("Background received message:",o),o.type){case"GET_SELECTED_TEXT":return i((t=n.tab)==null?void 0:t.id,e),!0;case"PROCESS_AI_REQUEST":return g(o.data,e),!0;default:console.warn("Unknown message type:",o.type)}});async function i(o,n){var e;try{if(!o){n({error:"No active tab found"});return}const r=((e=(await chrome.scripting.executeScript({target:{tabId:o},func:()=>{var s;return((s=window.getSelection())==null?void 0:s.toString())||""}}))[0])==null?void 0:e.result)||"";n({selectedText:r})}catch(t){console.error("Error getting selected text:",t),n({error:t instanceof Error?t.message:"Unknown error"})}}const l=c.BASE_URL;async function g(o,n){try{const e=`${l}/api/genai/process`;console.log("üöÄ VERTEX AI - Making API request to:",e),console.log("Request data:",o),console.log("API_BASE_URL from config:",c.BASE_URL);const t={action:o.action,text:o.text,options:o.options||{}};console.log("Request body:",JSON.stringify(t,null,2));const r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("Response status:",r.status,r.statusText),console.log("Response headers:",Object.fromEntries(r.headers.entries())),!r.ok){const a=await r.text();throw console.error("API Error Response:",a),new Error(`API Error: ${r.status} ${r.statusText} - ${a}`)}const s=await r.json();console.log("‚úÖ API Response success:",s),n(s)}catch(e){console.error("‚ùå Error processing AI request:",e),console.error("Error details:",{name:e instanceof Error?e.name:"Unknown",message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0}),n({error:e instanceof Error?e.message:"Unknown error",action:o.action})}}
